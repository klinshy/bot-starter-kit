(function(n,a){typeof exports=="object"&&typeof module<"u"?module.exports=a():typeof define=="function"&&define.amd?define(a):(n=typeof globalThis<"u"?globalThis:n||self,n.MyBot=a())})(this,function(){"use strict";const n={};return{run:async p=>{WA.onInit().then(async()=>{WA.chat.onChatMessage(async(o,r)=>{var i;if(r.author)try{WA.chat.startTyping({scope:"bubble"});const e=await fetch("https://ai.newit.works/api/v1/openai/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer VJD869M-CJC4KMF-JRWJFJD-Z5RNYQJ"},body:JSON.stringify({messages:[{role:"user",content:o}],model:WA.player.name,stream:!1,temperature:1})}).then(s=>s.json()),t=(i=e.choices[0])==null?void 0:i.message.content;if(t==null)throw new Error("Custom AI returned no response: "+JSON.stringify(e));console.log("Custom AI response:",t),WA.chat.sendChatMessage(t,{scope:"bubble"}),WA.chat.stopTyping({scope:"bubble"})}catch(e){console.error(e)}},{scope:"bubble"}),console.log("COUCOU",p)}),WA.player.proximityMeeting.onParticipantJoin().subscribe(async o=>{console.log(`User ${o.name} with UUID ${o.uuid} joined the proximity meeting.`);const r=await WA.player.name;if(!n[o.uuid])try{const t=(await fetch(`https://ai.newit.works/api/v1/workspace/${r}/thread/new`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer JM2QWSW-FVYM0C0-KBR1MG5-PE3WSKK","Accept-Encoding":"gzip, deflate, br",Accept:"*/*"},body:JSON.stringify({userId:6})}).then(s=>s.json())).data.thread.slug;n[o.uuid]=t,console.log(`Thread created with ID: ${t} for user ${o.uuid}`)}catch(e){console.error("Failed to create thread:",e)}const i=n[o.uuid];WA.chat.onChatMessage(async(e,t)=>{var s;if(t.author)try{WA.chat.startTyping({scope:"bubble"});const c=await fetch(`https://ai.newit.works/api/v1/workspace/${r}/thread/${i}/chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer JM2QWSW-FVYM0C0-KBR1MG5-PE3WSKK"},body:JSON.stringify({message:e,mode:"chat",userId:6})}).then(d=>d.json()),h=(s=c.choices[0])==null?void 0:s.message.content;if(h==null)throw new Error("Custom AI returned no response: "+JSON.stringify(c));console.log("Custom AI response:",h),WA.chat.sendChatMessage(h,{scope:"bubble"}),WA.chat.stopTyping({scope:"bubble"})}catch(c){console.error(c)}},{scope:"bubble"})})}}});
