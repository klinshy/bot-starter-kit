(function(a,s){typeof exports=="object"&&typeof module<"u"?module.exports=s():typeof define=="function"&&define.amd?define(s):(a=typeof globalThis<"u"?globalThis:a||self,a.MyBot=s())})(this,function(){"use strict";const a={};async function s(i,t){try{const e=(await fetch(`https://ai.newit.works/api/v1/workspace/${i}/thread/new`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer JM2QWSW-FVYM0C0-KBR1MG5-PE3WSKK","Accept-Encoding":"gzip, deflate, br",Accept:"*/*"},body:JSON.stringify({userId:6})}).then(o=>o.json())).data.thread.slug;return a[t]=e,console.log(`Thread created with ID: ${e} for user ${t}`),e}catch(n){throw console.error("Failed to create thread:",n),n}}async function c(i,t,n){var e;try{WA.chat.startTyping({scope:"bubble"});const o=await fetch(`https://ai.newit.works/api/v1/workspace/${i}/thread/${t}/chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer JM2QWSW-FVYM0C0-KBR1MG5-PE3WSKK"},body:JSON.stringify({message:n,mode:"chat",userId:6})}).then(h=>h.json()),r=(e=o.choices[0])==null?void 0:e.message.content;if(!r)throw new Error("Custom AI returned no response: "+JSON.stringify(o));console.log("Custom AI response:",r),WA.chat.sendChatMessage(r,{scope:"bubble"}),WA.chat.stopTyping({scope:"bubble"})}catch(o){console.error(o)}}return{run:async i=>{WA.onInit().then(async()=>{console.log("COUCOU",i)}),WA.player.proximityMeeting.onParticipantJoin().subscribe(async t=>{console.log(`User ${t.name} with UUID ${t.uuid} joined the proximity meeting.`);const n=await WA.player.name;let e=a[t.uuid];e||(e=await s(n,t.uuid)),WA.chat.onChatMessage(async(o,r)=>{r.author&&await c(n,e,o)},{scope:"bubble"})})}}});
