(function(i,a){typeof exports=="object"&&typeof module<"u"?module.exports=a():typeof define=="function"&&define.amd?define(a):(i=typeof globalThis<"u"?globalThis:i||self,i.MyBot=a())})(this,function(){"use strict";return{run:async a=>{const r={};async function c(e){try{console.log(`Creating thread for bot: ${e}`);const t=(await(await fetch(`https://ai.newit.works/api/v1/workspace/${e}/thread/new`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer JM2QWSW-FVYM0C0-KBR1MG5-PE3WSKK","Accept-Encoding":"gzip, deflate, br",Accept:"*/*"},body:JSON.stringify({userId:6})})).json()).thread.slug;return console.log(t),t}catch(o){throw console.error("Failed to create thread:",o),o}}async function d(e,o,n){try{console.log(`Handling chat message for bot: ${e}, thread: ${o}, message: ${n}`),WA.chat.startTyping({scope:"bubble"});const t=await fetch(`https://ai.newit.works/api/v1/workspace/kos/thread/${o}/chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer JM2QWSW-FVYM0C0-KBR1MG5-PE3WSKK","Accept-Encoding":"gzip, deflate, br",Accept:"*/*"},body:JSON.stringify({message:"test",mode:"chat",userId:6})}).then(h=>h.json()),s=t.textResponse;if(!s)throw new Error("Custom AI returned no text response: "+JSON.stringify(t));console.log("Custom AI text response:",s),WA.chat.sendChatMessage(s,{scope:"bubble"}),WA.chat.stopTyping({scope:"bubble"})}catch(t){console.error("Failed to handle chat message:",t)}}WA.onInit().then(async()=>{console.log("COUCOU",a)}),WA.player.proximityMeeting.onParticipantJoin().subscribe(async e=>{console.log(`User ${e.name} with UUID ${e.uuid} joined the proximity meeting.`);const o=await WA.player.name;let n=r[e.uuid];n?console.log(`Found existing thread ${n} for user ${e.uuid}.`):(console.log(`No existing thread for user ${e.uuid}, creating new thread.`),n=await c(o)),WA.chat.onChatMessage(async(t,s)=>{if(!s.author){console.log("Received message with no author, ignoring.");return}console.log(`Received message from ${s.author.name}: ${t}`),await d(o,n,t)},{scope:"bubble"})})}}});
